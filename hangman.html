<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDMkOW4qJzEYUHD4XM54JUaYxJlG_LlOyY",
        authDomain: "hangman-1be2a.firebaseapp.com",
        databaseURL: "https://hangman-1be2a.firebaseio.com",
        projectId: "hangman-1be2a",
        storageBucket: "",
        messagingSenderId: "23028470893"
    };
    firebase.initializeApp(config);
    </script>

    <title>Hangman!</title>
</head>
<body>

    <h1>Welcome to the hangman game!</h1>
    <h3>Description of word: <span id="description"></span></h3>
    <h3>Lives: <span id="lives"></span></h3>
    <p>Word: <span id="word"></span></p>
    <p>Score: <span id="score"></span></p>
    <button id="restart">Restart</button>
    <h1 id="end"></h1>
    <table id="leaderboard" style="display:none">
        <tr>
            <th>Name</th>
            <th>Score</th>
        </tr>

    </table>


    <script>
        let list_of_words = ["Committee", "Tattoo", "Electricity"]
        let description_of_words = {"Committee": "Desc of committee",
                             "Tattoo": "A form of body modification where a design is made by inserting ink",
                             "Electricity": "Is the set of physical phenomena associated with the presence and motion of electric charge"}
        let lives = 7;
        let score = 0;
        let guess;
        let displayedword = [];
        let word;

        function reload(){
            document.location.reload()
        }


        function generateLetters() {
            for (i = 0; i < 26; i++) {
                let btn = document.createElement("button");
                document.body.appendChild(btn);
                btn.innerHTML = String.fromCharCode(65 + i);
                btn.id = btn.innerHTML;
                btn.style.marginRight = "5px"; //Put in CSS File
                btn.onclick = function () {
                    guess = btn.innerHTML;
                    validGuess();
                }
            }
        }

        function hide(){
            for (i=0; i<26; i++) {
                alphabet = String.fromCharCode(65 + i)
                document.getElementById(alphabet).style.display="none";
            }
        }

        function generateWord() {
            let num = Math.floor(Math.random() * 3);
            word = list_of_words[num];
            for (i = 0; i < word.length; i++) {
                displayedword.push("_");
            }
        }

        function displayGame() {
            document.getElementById("description").innerHTML = description_of_words[word];
            document.getElementById("lives").innerHTML = lives;
            document.getElementById("score").innerHTML = score;
            let current_word = ""
            for (i = 0; i < displayedword.length; i++) {
                current_word += displayedword[i];
                current_word += " "
            }
            document.getElementById("word").innerHTML = current_word;
        }

        function decrementLives() {
            lives -= 1;
        }

        function validGuess() {
            let valid = false;
            for (i = 0; i < word.length; i++) {
                if (guess == word.charAt(i).toUpperCase()) {
                    displayedword[i] = guess;
                    incrementScore();
                    valid = true;
                }
            }
            if (valid == false) {
                decrementScore();
                decrementLives();
            }
            removeButton();
            displayGame();
            checkGameStatus();
        }

        function checkGameStatus() {
            end = true;
            if (lives == 0) {
                endGame("lost");
                hide()
            }
            for (i = 0; i < displayedword.length; i++) {
                if (displayedword[i] == "_") {
                    end = false;
                }
            }
            if (end == true) {
                firebase.database().ref("Scores/").update({
                    [name]: score
                });
                generateLeaderboard();
                document.getElementById("leaderboard").style.display = "table";
                endGame("won")
                hide()
            }
        }

        function incrementScore() {
            score += 1;
        }

        function decrementScore() {
            score -= 1;
        }

        function restartGame() {
            for (i = 0; i < 26; i++) {
                document.getElementById(String.fromCharCode(65 + i)).style.display = "inline-block";
            }
            document.getElementById('leaderboard').style.display="none";
            lives = 7;
            score = 0;
            displayedword = [];
            generateWord();
            displayGame();
            reload();
        }

        function removeButton() {
            document.getElementById(guess).style.display = "none";
        }

        function endGame(result) {
            document.getElementById("end").innerHTML = name + ", you have " + result + "! Your score is " + score + "!";
        }


        let name = prompt("Please enter your name: ");
        generateLetters();
        generateWord();
        displayGame();
        document.getElementById("restart").onclick = restartGame;


        function generateLeaderboard () {
            var out = document.getElementById("test");
            var db = firebase.database().ref().child("Scores")
            db.on(
                "value",
                function(snap){
                    dict_of_scores = snap.val();
                    scores = Object.values(dict_of_scores);
                    leadername = Object.keys(dict_of_scores);
                    sortable_scores = [];
                    for (i = 0; i < leadername.length; i++) {
                        sortable_scores.push([leadername[i], dict_of_scores[leadername[i]]])
                    }
                    console.log(sortable_scores[0]);
                    sorted_scores = [];
                    sorted_scores.push(sortable_scores[0]);
                    for (i = 1; i < sortable_scores.length; i++) {
                        if (sortable_scores[i][1] > sorted_scores[0][1]) {
                            sorted_scores.unshift(sortable_scores[i])
                        }
                        else {
                            let counter = 0
                            for (j = 0; j < sorted_scores.length; j++) {
                                if (sortable_scores[i][1] < sorted_scores[j][1]) {
                                    counter += 1;
                                }
                            }
                            sorted_scores.splice(counter, 0, sortable_scores[i]);
                        }
                    }
                    for (i = 0; i < sorted_scores.length; i++) {
                        let tr = document.createElement("tr");
                        let td = document.createElement("td");
                        let td2 = document.createElement("td");
                        document.getElementById("leaderboard").appendChild(tr);
                        tr.appendChild(td);
                        tr.appendChild(td2);
                        td.innerHTML = sorted_scores[i][0];
                        td2.innerHTML = sorted_scores[i][1];
                    }
                    console.log("I got run")
                }
            )
        }
        
    
    
    </script>

</body>
</html>